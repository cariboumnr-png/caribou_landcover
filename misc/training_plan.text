Total Pixels (all classes): 592,520,100
Masked Pixels (ISL (1), WAT (2), NODATA (14)): 66,858,873
Valid Pixels (after masking): 525,661,227

Layer 1 Distribution (after masking):
--------------------------------------
Treed        | Pixel Count: 432,392,477 | 82.26%
Wetland      | Pixel Count: 34,950,316  |  6.65%
Non-Treed    | Pixel Count: 13,175,449  |  2.51%
Disturbed    | Pixel Count: 49,339,531  |  9.39%
Other        | Pixel Count:  8,533,291  |  1.62%

Layer 2 Intra-Group Distributions:
----------------------------------

Treed (432,392,477 pixels):
  FOR_OLD (7)        | Pixel Count: 337,527,490 | 78.06%
  FOR_EST (8)        | Pixel Count:  82,135,150 | 19.00%

Wetland (34,950,316 pixels):
  OMS (4)            | Pixel Count: 22,220,479  | 63.58%
  TMS (6)            | Pixel Count: 12,729,837  | 36.42%

Non-Treed (13,175,449 pixels):
  BSH (5)            | Pixel Count:  6,586,879  | 49.99%
  GRS (12)           | Pixel Count:  2,386,650  | 18.11%
  DAL (15)           | Pixel Count:  4,201,920  | 31.89%

Disturbed (49,339,531 pixels):
  RECENT_FIRE (3)    | Pixel Count: 17,050,919  | 34.56%
  RECENT_DIST (11)   | Pixel Count:  4,040,461  |  8.19%
  RECENT_HARV (13)   | Pixel Count: 28,248,151  | 57.25%

Other (8,533,291 pixels):
  UCL (9)            | Pixel Count:  7,030,982  | 82.39%
  RCK (10)           | Pixel Count:  1,502,309  | 17.61%


Layer-Level 位 Weights (Heads):
------------------------------
Layer 1 (Coarse classes): 1.0
Layer 2 Heads:
  Treed: 0.5
  Wetland: 1.0
  Non-Treed: 1.2
  Disturbed: 1.0

Class-Level 位 Weights:
-----------------------

Layer 1 Classes:
  Treed        | 位 = 0.5
  Wetland      | 位 = 2.0
  Non-Treed    | 位 = 3.0
  Disturbed    | 位 = 2.0
  Other        | 位 = 3.0

Layer 2 Heads:
  Treed Head:
    FOR_OLD (7)  | 位 = 0.5
    FOR_EST (8)  | 位 = 2.0

  Wetland Head:
    OMS (4)      | 位 = 1.0
    TMS (6)      | 位 = 1.8

  Non-Treed Head:
    BSH (5)      | 位 = 1.0
    DAL (15)     | 位 = 1.5
    GRS (12)     | 位 = 2.0

  Disturbed Head:
    RECENT_HARV (13) | 位 = 0.8
    RECENT_FIRE (3)  | 位 = 1.2
    RECENT_DIST (11) | 位 = 3.0


Curriculum Learning Workflow for Hierarchical Segmentation
----------------------------------------------------------

Phase 0: Data Preparation
- Mask ISL (1), WAT (2), NODATA (14) completely.
- Prepare Layer 1 labels: Treed, Wetland, Non-Treed, Disturbed, Other.
- Prepare Layer 2 labels: Subclasses grouped under Treed, Wetland, Non-Treed, Disturbed.
- Ensure ignore_index (e.g., 255) for invalid pixels in each head.

Phase 1: Train Layer 1 Only
- Mask out Treed pixels initially (optional) to balance classes.
- Train on Wetland, Non-Treed, Disturbed, Other first for a few epochs.
- Then unmask Treed and train full Layer 1 until stable (low validation loss, good accuracy).

Phase 2: Introduce Layer 2 Heads Gradually
- Start with Wetland head (less imbalanced).
- Add Non-Treed head next.
- Add Disturbed head.
- Finally add Treed head (largest group, most imbalance).
- Use 位 weights for heads and per-class weights within heads.

Phase 3: Full Multi-Head Training
- Train all heads together with combined loss:
    Total Loss = 位_layer1 * Loss_layer1 + 危 位_head_i * Loss_head_i
- Use Dice + Focal loss with per-class weights.
- Optionally apply dynamic 位 adjustment or GradNorm for balancing.

Phase 4: Fine-Tuning
- Reduce learning rate.
- Optionally freeze encoder and fine-tune decoder + heads.
- Validate on hierarchical consistency (e.g., Layer 2 predictions only where Layer 1 is valid).

Optional Enhancements:
- Hard example mining for minority classes.
- Oversample tiles with Wetland/Non-Treed/Disturbed pixels.
- Confidence-based masking for Layer 2 during early epochs.

Goal:
- Build strong coarse classification first.
- Gradually introduce complexity to stabilize training and reduce error propagation.


 Prompt for Hybrid CNN + Transformer Architecture

"Design a hybrid deep learning model for pixel-level landcover classification using high-resolution continuous inputs (e.g., Landsat bands, DEM) and coarse-resolution categorical inputs (e.g., geology, soil types). The model should use CNN layers to extract local features and Transformer layers to model regional context and long-range dependencies. Include suggestions for input preprocessing, fusion strategy, and loss functions suitable for ecosite classification."


 Prompt for CNN + Embedded Categorical Inputs Architecture

"Create a CNN-based model for pixel-level landcover classification using continuous inputs (e.g., Landsat bands, DEM) and categorical inputs (e.g., geology, soil types) with many classes. Use embedding layers to convert categorical inputs into dense vectors and tile them spatially to match the resolution of continuous inputs. Concatenate all inputs and feed into a U-Net or ResNet-style architecture. Include preprocessing steps and training considerations."
